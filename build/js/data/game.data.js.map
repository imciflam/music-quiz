{"version":3,"file":"game.data.js","sources":["js/data/game.data.js"],"sourcesContent":["export const LEVELS_COUNT = 10;\nexport const FAST_ANSWER_PERIOD = 30;\nexport const MAX_ERRORS_COUNT = 4;\nexport const TIME_FOR_GAME = 60 * 5 + 1; // 5 minutes + 1 second\n\nconst Label = {\n  GAME: `Угадай мелодию`,\n\n  TITLE_WIN: `Вы настоящий меломан!`,\n  TITLE_WELCOME: `Правила игры`,\n  TITLE_FAIL_TIME: `Увы и ах!`,\n  TITLE_FAIL_TRY: `Какая жалость!`,\n\n  BUTTON_WELCOME: `Начать игру`,\n  BUTTON_WIN: `Сыграть ещё раз`,\n  BUTTON_FAIL: `Попробовать ещё раз`\n};\n\nexport const phrase = {\n  timeIsUp: () => `Время вышло!<br>Вы не успели отгадать все мелодии`,\n  noMoreAttempts: () =>\n    `У вас закончились все попытки.<br>Ничего, повезёт в следующий раз!`,\n  win: ({ place, playersCount, betterThan }) =>\n    `Вы заняли ${place}-ое место из ${playersCount} игроков. Это&nbsp;лучше чем у&nbsp;${betterThan}%&nbsp;игроков`\n};\n\nexport const welcome = {\n  name: Label.GAME,\n  title: Label.TITLE_WELCOME,\n  rules: [\n    `Правила просты&nbsp;— за&nbsp;5 минут ответить на все вопросы.`,\n    `Ошибиться можно 3 раза.`,\n    `Удачи!`\n  ],\n  button: Label.BUTTON_WELCOME\n};\n\nexport const resultTry = {\n  name: Label.GAME,\n  title: Label.TITLE_FAIL_TRY,\n  button: Label.BUTTON_FAIL,\n  isWin: false\n};\n\nexport const resultTime = {\n  name: Label.GAME,\n  title: Label.TITLE_FAIL_TIME,\n  button: Label.BUTTON_FAIL,\n  content: phrase.timeIsUp(),\n  isWin: false\n};\n\nexport const resultWin = {\n  name: Label.GAME,\n  title: Label.TITLE_WIN,\n  button: Label.BUTTON_WIN,\n  isWin: true\n};\n\nexport const initialGame = {\n  level: -1,\n  remainingAttempts: MAX_ERRORS_COUNT,\n  time: TIME_FOR_GAME,\n  answers: []\n};\n\nexport const tick = game => {\n  game = Object.assign({}, game);\n  game.time--;\n  return game;\n};\n\nexport const getLevel = (index, allLevels) => allLevels[index];\n\nexport const showNextLevel = (state, allLevels) => {\n  const index = state.level + 1;\n  if (!getLevel(index, allLevels)) {\n    throw new RangeError(`Can't find level ${index}`);\n  }\n  state.level = index;\n  return state;\n};\n\nexport const startGame = () => {\n  showNextLevel();\n};\n\nexport const getScore = answers => {\n  let score = -1;\n  //if all answers were submitted\n  if (answers.length === LEVELS_COUNT) {\n    score = answers.reduce((acc, it) => {\n      let point = -2;\n      if (it.isCorrect) {\n        //if faster than 30 s then +2 points\n        point = it.timeSpent < FAST_ANSWER_PERIOD ? 2 : 1;\n      }\n      return acc + point;\n    }, 0);\n  }\n  return score;\n};\n\nexport const getFastScore = answers => {\n  const slowScore = answers.filter(\n    it => it.isCorrect && it.timeSpent >= FAST_ANSWER_PERIOD\n  ).length;\n  return getScore(answers) - slowScore;\n};\n\nconst getTimeSpent = answers => {\n  let time = answers.reduce((acc, it) => {\n    return acc + it.timeSpent;\n  }, 0);\n  return time;\n};\n\nconst getPosition = (scoreBoard, score) => {\n  // создаём из таблицы результатов, массив объектов: { position, score }\n  const statisticsIndexed = scoreBoard.map(\n    (scoreFromStaticstics, position) => ({\n      position,\n      score: scoreFromStaticstics\n    })\n  );\n\n  // кладём в таблицу результат новой игры\n  statisticsIndexed.push({\n    position: null,\n    score\n  });\n\n  // получаем позицию новой игры в таблице результатов\n  const position = statisticsIndexed\n    .sort((a, b) => b.score - a.score)\n    .reduce((acc, it, index) => {\n      if (it.position === null) {\n        acc = index;\n      }\n      return acc;\n    }, -1);\n\n  if (position === -1) {\n    throw new Error(`Can't define position in Scoreboard`);\n  }\n  return position;\n};\n\nexport const printResult = (scoreBoard = [], game) => {\n  let endGameMessage = ``;\n  const score = getScore(game.answers);\n  const time = getTimeSpent(game.answers);\n\n  if (game.remainingAttempts > 0 && time < TIME_FOR_GAME) {\n    // выйгрыш\n    const position = getPosition(scoreBoard, score);\n    scoreBoard.push(score);\n    scoreBoard.sort((a, b) => b - a);\n\n    resultWin.place = position + 1;\n    resultWin.playersCount = scoreBoard.length;\n    resultWin.betterThan = Math.round(\n      ((scoreBoard.length - position - 1) * 100) / scoreBoard.length\n    );\n\n    endGameMessage = phrase.win(resultWin);\n  } else {\n    // проигрыш\n    endGameMessage =\n      time > TIME_FOR_GAME ? phrase.timeIsUp() : phrase.noMoreAttempts();\n  }\n\n  return endGameMessage;\n};\n"],"names":[],"mappings":";;;AAAO,MAAM,YAAY,GAAG,EAAE,CAAC;AAC/B,AAAO,MAAM,kBAAkB,GAAG,EAAE,CAAC;AACrC,AAAO,MAAM,gBAAgB,GAAG,CAAC,CAAC;AAClC,AAAO,MAAM,aAAa,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC;;AAExC,MAAM,KAAK,GAAG;EACZ,IAAI,EAAE,CAAC,cAAc,CAAC;;EAEtB,SAAS,EAAE,CAAC,qBAAqB,CAAC;EAClC,aAAa,EAAE,CAAC,YAAY,CAAC;EAC7B,eAAe,EAAE,CAAC,SAAS,CAAC;EAC5B,cAAc,EAAE,CAAC,cAAc,CAAC;;EAEhC,cAAc,EAAE,CAAC,WAAW,CAAC;EAC7B,UAAU,EAAE,CAAC,eAAe,CAAC;EAC7B,WAAW,EAAE,CAAC,mBAAmB,CAAC;CACnC,CAAC;;AAEF,AAAO,MAAM,MAAM,GAAG;EACpB,QAAQ,EAAE,MAAM,CAAC,iDAAiD,CAAC;EACnE,cAAc,EAAE;IACd,CAAC,kEAAkE,CAAC;EACtE,GAAG,EAAE,CAAC,EAAE,KAAK,EAAE,YAAY,EAAE,UAAU,EAAE;IACvC,CAAC,UAAU,EAAE,KAAK,CAAC,aAAa,EAAE,YAAY,CAAC,oCAAoC,EAAE,UAAU,CAAC,cAAc,CAAC;CAClH,CAAC;;AAEF,AAAO,MAAM,OAAO,GAAG;EACrB,IAAI,EAAE,KAAK,CAAC,IAAI;EAChB,KAAK,EAAE,KAAK,CAAC,aAAa;EAC1B,KAAK,EAAE;IACL,CAAC,8DAA8D,CAAC;IAChE,CAAC,uBAAuB,CAAC;IACzB,CAAC,MAAM,CAAC;GACT;EACD,MAAM,EAAE,KAAK,CAAC,cAAc;CAC7B,CAAC;;AAEF,AAAO,MAAM,SAAS,GAAG;EACvB,IAAI,EAAE,KAAK,CAAC,IAAI;EAChB,KAAK,EAAE,KAAK,CAAC,cAAc;EAC3B,MAAM,EAAE,KAAK,CAAC,WAAW;EACzB,KAAK,EAAE,KAAK;CACb,CAAC;;AAEF,AAAO,MAAM,UAAU,GAAG;EACxB,IAAI,EAAE,KAAK,CAAC,IAAI;EAChB,KAAK,EAAE,KAAK,CAAC,eAAe;EAC5B,MAAM,EAAE,KAAK,CAAC,WAAW;EACzB,OAAO,EAAE,MAAM,CAAC,QAAQ,EAAE;EAC1B,KAAK,EAAE,KAAK;CACb,CAAC;;AAEF,AAAO,MAAM,SAAS,GAAG;EACvB,IAAI,EAAE,KAAK,CAAC,IAAI;EAChB,KAAK,EAAE,KAAK,CAAC,SAAS;EACtB,MAAM,EAAE,KAAK,CAAC,UAAU;EACxB,KAAK,EAAE,IAAI;CACZ,CAAC;;AAEF,AAAO,MAAM,WAAW,GAAG;EACzB,KAAK,EAAE,CAAC,CAAC;EACT,iBAAiB,EAAE,gBAAgB;EACnC,IAAI,EAAE,aAAa;EACnB,OAAO,EAAE,EAAE;CACZ,CAAC;;AAEF,AAAO,MAAM,IAAI,GAAG,IAAI,IAAI;EAC1B,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;EAC/B,IAAI,CAAC,IAAI,EAAE,CAAC;EACZ,OAAO,IAAI,CAAC;CACb,CAAC;;AAEF,AAAO,MAAM,QAAQ,GAAG,CAAC,KAAK,EAAE,SAAS,KAAK,SAAS,CAAC,KAAK,CAAC,CAAC;;AAE/D,AAAO,MAAM,aAAa,GAAG,CAAC,KAAK,EAAE,SAAS,KAAK;EACjD,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC;EAC9B,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,SAAS,CAAC,EAAE;IAC/B,MAAM,IAAI,UAAU,CAAC,CAAC,iBAAiB,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;GACnD;EACD,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;EACpB,OAAO,KAAK,CAAC;CACd,CAAC;;AAEF,AAAO,MAAM,SAAS,GAAG,MAAM;EAC7B,aAAa,EAAE,CAAC;CACjB,CAAC;;AAEF,AAAO,MAAM,QAAQ,GAAG,OAAO,IAAI;EACjC,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;;EAEf,IAAI,OAAO,CAAC,MAAM,KAAK,YAAY,EAAE;IACnC,KAAK,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,KAAK;MAClC,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;MACf,IAAI,EAAE,CAAC,SAAS,EAAE;;QAEhB,KAAK,GAAG,EAAE,CAAC,SAAS,GAAG,kBAAkB,GAAG,CAAC,GAAG,CAAC,CAAC;OACnD;MACD,OAAO,GAAG,GAAG,KAAK,CAAC;KACpB,EAAE,CAAC,CAAC,CAAC;GACP;EACD,OAAO,KAAK,CAAC;CACd,CAAC;;AAEF,AAAO,MAAM,YAAY,GAAG,OAAO,IAAI;EACrC,MAAM,SAAS,GAAG,OAAO,CAAC,MAAM;IAC9B,EAAE,IAAI,EAAE,CAAC,SAAS,IAAI,EAAE,CAAC,SAAS,IAAI,kBAAkB;GACzD,CAAC,MAAM,CAAC;EACT,OAAO,QAAQ,CAAC,OAAO,CAAC,GAAG,SAAS,CAAC;CACtC,CAAC;;AAEF,MAAM,YAAY,GAAG,OAAO,IAAI;EAC9B,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,KAAK;IACrC,OAAO,GAAG,GAAG,EAAE,CAAC,SAAS,CAAC;GAC3B,EAAE,CAAC,CAAC,CAAC;EACN,OAAO,IAAI,CAAC;CACb,CAAC;;AAEF,MAAM,WAAW,GAAG,CAAC,UAAU,EAAE,KAAK,KAAK;;EAEzC,MAAM,iBAAiB,GAAG,UAAU,CAAC,GAAG;IACtC,CAAC,oBAAoB,EAAE,QAAQ,MAAM;MACnC,QAAQ;MACR,KAAK,EAAE,oBAAoB;KAC5B,CAAC;GACH,CAAC;;;EAGF,iBAAiB,CAAC,IAAI,CAAC;IACrB,QAAQ,EAAE,IAAI;IACd,KAAK;GACN,CAAC,CAAC;;;EAGH,MAAM,QAAQ,GAAG,iBAAiB;KAC/B,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC;KACjC,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,EAAE,KAAK,KAAK;MAC1B,IAAI,EAAE,CAAC,QAAQ,KAAK,IAAI,EAAE;QACxB,GAAG,GAAG,KAAK,CAAC;OACb;MACD,OAAO,GAAG,CAAC;KACZ,EAAE,CAAC,CAAC,CAAC,CAAC;;EAET,IAAI,QAAQ,KAAK,CAAC,CAAC,EAAE;IACnB,MAAM,IAAI,KAAK,CAAC,CAAC,mCAAmC,CAAC,CAAC,CAAC;GACxD;EACD,OAAO,QAAQ,CAAC;CACjB,CAAC;;AAEF,AAAO,MAAM,WAAW,GAAG,CAAC,UAAU,GAAG,EAAE,EAAE,IAAI,KAAK;EACpD,IAAI,cAAc,GAAG,CAAC,CAAC,CAAC;EACxB,MAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;EACrC,MAAM,IAAI,GAAG,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;;EAExC,IAAI,IAAI,CAAC,iBAAiB,GAAG,CAAC,IAAI,IAAI,GAAG,aAAa,EAAE;;IAEtD,MAAM,QAAQ,GAAG,WAAW,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;IAChD,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACvB,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;;IAEjC,SAAS,CAAC,KAAK,GAAG,QAAQ,GAAG,CAAC,CAAC;IAC/B,SAAS,CAAC,YAAY,GAAG,UAAU,CAAC,MAAM,CAAC;IAC3C,SAAS,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK;MAC/B,CAAC,CAAC,UAAU,CAAC,MAAM,GAAG,QAAQ,GAAG,CAAC,IAAI,GAAG,IAAI,UAAU,CAAC,MAAM;KAC/D,CAAC;;IAEF,cAAc,GAAG,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;GACxC,MAAM;;IAEL,cAAc;MACZ,IAAI,GAAG,aAAa,GAAG,MAAM,CAAC,QAAQ,EAAE,GAAG,MAAM,CAAC,cAAc,EAAE,CAAC;GACtE;;EAED,OAAO,cAAc,CAAC;CACvB,CAAC,;;;;;;;;;;;;;;;;;;,;;"}