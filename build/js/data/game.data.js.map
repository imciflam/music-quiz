{"version":3,"file":"game.data.js","sources":["js/data/game.data.js"],"sourcesContent":["export const QUESTIONS_COUNT = 10;\r\nconst FAST_ANSWER_PERIOD = 30;\r\nconst TIME_FOR_GAME = 60 * 5; // 5 mins\r\nconst statistics = [];\r\nconst PRICE_OF_ERROR = 2;\r\nconst MAX_ERRORS_COUNT = 3;\r\n\r\nconst phrases = {\r\n  timeIsUp: () => `Время вышло! Вы не успели отгадать все мелодии`,\r\n  noMoreAttempts: () =>\r\n    `У вас закончились все попытки. Ничего, повезёт в следующий раз!`,\r\n  win: ({ place, playersCount, betterThan }) =>\r\n    `Вы заняли ${place}-ое место из ${playersCount} игроков. Это лучше чем у ${betterThan} игроков`\r\n};\r\n\r\nconst sum = arr => arr.reduce((acc, item) => acc + item);\r\nconst penalty = livesLeft => (MAX_ERRORS_COUNT - livesLeft) * PRICE_OF_ERROR;\r\n\r\nexport const resultsCount = ({ attempt, livesLeft }) => {\r\n  let result = -1;\r\n\r\n  if (attempt.length === QUESTIONS_COUNT) {\r\n    result = sum(attempt) - penalty(livesLeft);\r\n  }\r\n  return result;\r\n};\r\n\r\nconst getScore = ({ answers, rest }) => {\r\n  let score = -1;\r\n\r\n  if (answers.length === QUESTIONS_COUNT) {\r\n    // result = sum(attempt) - penalty(rest);\r\n    // result = sum(answers);\r\n\r\n    score = answers\r\n      .map(it => {\r\n        let points = -2;\r\n        if (it.isCorrect) {\r\n          if (it.timeSpent < FAST_ANSWER_PERIOD) {\r\n            points = 2;\r\n          } else {\r\n            points = 1;\r\n          }\r\n        }\r\n        return points;\r\n      })\r\n      .reduce((acc, it) => acc + it);\r\n  }\r\n  return score;\r\n};\r\n\r\nconst printResult = (games, game) => {\r\n  const score = getScore(game);\r\n  if (score < 0) {\r\n    if (game.rest > 0) {\r\n      return phrases.timeIsUp();\r\n    } else {\r\n      return phrases.noMoreAttempts();\r\n    }\r\n  }\r\n\r\n  const gameId = +new Date();\r\n  statistics.push({ score, gameId });\r\n  const index = statistics\r\n    .sort((a, b) => b - a)\r\n    .filter((it, i) => (it.gameId === gameId ? i : null));\r\n\r\n  if (index === null) {\r\n    throw new Error(`Алгоритм сломалсо`);\r\n  }\r\n  const stats = {\r\n    playersCount: statistics.length,\r\n    place: index + 1,\r\n    betterThan: ((stats.playersCount - stats.place) * 100) / stats.playersCount\r\n  };\r\n  return phrases.win(stats);\r\n};\r\n\r\nexport { MAX_ERRORS_COUNT, getScore, printResult };\r\n"],"names":[],"mappings":"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"}