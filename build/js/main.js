!function(){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t){return(1<arguments.length&&void 0!==t?t:window.document).querySelector(e)}function h(e){y.replaceChild(e.element,u("section.main"))}function m(e,t,n){(2<arguments.length&&void 0!==n?n:y).addEventListener(e,function(e){t(e)})}function f(e,t){var n=new CustomEvent(e,{detail:1<arguments.length&&void 0!==t?t:null});y.dispatchEvent(n)}function p(e,t){return(1<arguments.length&&void 0!==t?t:b)[e]}function d(e){var t=-1;return 10===e.length&&(t=e.reduce(function(e,t){var n=-2;return t.isCorrect&&(n=t.timeSpent<30?2:1),e+n},0)),t}function v(e,t){var n="",i=d(t.answers),r=function(e){return e.reduce(function(e,t){return e+t.timeSpent},0)}(t.answers);if(0<t.remainingAttempts&&r<301){var a=function(e,t){var n=e.map(function(e,t){return{position:t,score:e}});n.push({position:null,score:t});var i=n.sort(function(e,t){return t.score-e.score}).reduce(function(e,t,n){return null===t.position&&(e=n),e},-1);if(-1===i)throw new Error("Can't define position in Scoreboard");return i}(e,i);e.push(i),e.sort(function(e,t){return t-e});var s={place:a+1,playersCount:e.length,betterThan:Math.round(100*(e.length-a-1)/e.length)};n=T(s)}else n=301<r?C():E();return n}var y=u(".app"),t=function(){function e(){r(this,e)}return a(e,[{key:"render",value:function(){return function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}(this.template.trim())}},{key:"bind",value:function(){}},{key:"template",get:function(){throw new Error("Provide template for view")}},{key:"element",get:function(){return this._element||(this._element=this.render(),this.bind()),this._element}}]),e}(),w=function(){function n(e){var t;return r(this,n),(t=o(this,s(n).call(this))).data=e,t}return e(n,t),a(n,[{key:"bind",value:function(){m("click",function(){return f("start")},u(".main-play",this.element))}},{key:"onStart",value:function(){}},{key:"template",get:function(){var e=this.data,t=e.name,n=e.button,i=e.title,r=e.rules;return'\n<section class="main main--welcome">\n  <section class="logo" title="'.concat(t,'"><h1>').concat(t,'</h1></section>\n  <button class="main-play">').concat(n,'</button>\n  <h2 class="title main-title">').concat(i,'</h2>\n  <p class="text main-text">').concat(r.reduce(function(e,t,n,i){return e+(t+=n<i.length-1?"<br>":"")},""),"</p>\n</section>").trim()}}]),n}(),g=[{artist:"Kevin MacLeod",name:"Long Stroll",image:"https://yt3.ggpht.com/-fkDeGauT7Co/AAAAAAAAAAI/AAAAAAAAAAA/dkF5ZKkrxRo/s900-c-k-no-mo-rj-c0xffffff/photo.jpg",src:"https://www.youtube.com/audiolibrary_download?vid=91624fdc22fc54ed",genre:"Jazz"},{artist:"Jingle Punks",name:"In the Land of Rhinoplasty",image:"https://i.vimeocdn.com/portrait/992615_300x300",src:"https://www.youtube.com/audiolibrary_download?vid=dc3b4dc549becd6b",genre:"Rock"},{artist:"Audionautix",name:"Travel Light",image:"http://4.bp.blogspot.com/-kft9qu5ET6U/VPFUBi9W-MI/AAAAAAAACYM/UxXilXKYwOc/s1600/audionautix%2BHalf%2BSize.jpg",src:"https://www.youtube.com/audiolibrary_download?vid=a127d9b7de8a17cf",genre:"Country"},{artist:"Riot",name:"\tLevel Plane",image:"https://i.ytimg.com/vi/jzgM3m8Vp1k/maxresdefault.jpg",src:"https://www.youtube.com/audiolibrary_download?vid=dfb828f40096184c",genre:"R&B"},{artist:"Jingle Punks",name:"Lucky Day",image:"https://i.vimeocdn.com/portrait/992615_300x300",src:"https://www.youtube.com/audiolibrary_download?vid=bcbe5be936a32fb1",genre:"Pop"},{artist:"Gunnar Olsen",name:"Home Stretch",image:"https://f4.bcbits.com/img/0004181452_10.jpg",src:"https://www.youtube.com/audiolibrary_download?vid=bcbe5be936a32fb1",genre:"Electronic"}],b=[{type:"Genre",title:"Choose Jazz tracks",questions:[g[0],g[1],g[2],g[3]],answer:"1000"},{type:"Genre",title:"Choose Rock tracks",questions:[g[0],g[1],g[2],g[3]],answer:"0110"},{type:"Genre",title:"Choose Country tracks",questions:[g[0],g[1],g[2],g[3]],answer:"0010"},{type:"Genre",title:"Choose R&B tracks",questions:[g[0],g[1],g[2],g[3]],answer:"0001"},{type:"Genre",title:"Choose Pop tracks",questions:[g[4],g[1],g[2],g[3]],answer:"1000"},{type:"Genre",title:"Choose Electronic tracks",questions:[g[0],g[5],g[2],g[3]],answer:"0100"},{type:"Artist",title:"Who performs this song?",questions:[g[0],g[1],g[2]],src:g[0].src,answer:0},{type:"Artist",title:"Who performs this song?",questions:[g[1],g[2],g[3]],src:g[2].src,answer:1},{type:"Artist",title:"Who performs this song?",questions:[g[3],g[2],g[1]],src:g[1].src,answer:2},{type:"Artist",title:"Who performs this song?",questions:[g[0],g[1],g[2]],src:g[1].src,answer:1}],k="Guess a melody",A="You're a true music fan!",L="Play again",x="Try again",C=function(){return"Time is up!<br>You didn't make it on time."},E=function(){return"You have run out of attempts.<br>Better luck next time!"},T=function(e){var t=e.place,n=e.playersCount,i=e.betterThan;return"You've taken ".concat(t," place out of ").concat(n," players. It's&nbsp;better than &nbsp;").concat(i,"%&nbsp; other players' results")},G={name:k,title:"Game rules",rules:["Rules are simple&nbsp;â€” &nbsp;you have to answer all questions in 5 minites.","You can make 3 mistakes.","Good luck!"],button:"Start game"},O={name:k,title:"Such a pity!",button:x,isWin:!1},S={name:k,title:"Alas..",button:x,content:C(),isWin:!1},j={name:k,title:A,button:L,isWin:!0},q=[],_={level:-1,remainingAttempts:4,time:301,answers:[]},R=new(function(){function e(){r(this,e),this.view=new w(G)}return a(e,[{key:"init",value:function(){h(this.view)}}]),e}()),M=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:b;r(this,t),this.data=e}return a(t,[{key:"update",value:function(e){return this.state=Object.assign({},this.state,e),this.state}},{key:"resetAnswers",value:function(e){e.answers=[]}},{key:"getCurrentLevel",value:function(){return p(this.state.level,this.data)}},{key:"nextLevel",value:function(){this.update(function(e,t){var n=1<arguments.length&&void 0!==t?t:b,i=e.level+1;if(!p(i,n))throw new RangeError("Can't find level ".concat(i));return e.level=i,e}(this.state,this.data))}},{key:"tick",value:function(){this.update(function(e){return(e=Object.assign({},e)).time--,e}(this.state))}},{key:"getMistakes",value:function(){return 4-this.state.remainingAttempts}},{key:"getLevelType",value:function(){return this.getCurrentLevel().type}},{key:"getAllLevelsTypes",value:function(){return function(e){return(0<arguments.length&&void 0!==e?e:b).map(function(e){return e.type})}()}},{key:"isLastLevel",value:function(){return 9===this.state.level}},{key:"win",value:function(){j.content=v(q,this.state),j.score=d(this.state.answers),j.errors=this.getMistakes()}},{key:"failOnMistakes",value:function(){O.content=v(q,this.state)}}]),t}(),P=function(){function i(e,t){var n;return r(this,i),(n=o(this,s(i).call(this))).errors=e,n.time=t,n}return e(i,t),a(i,[{key:"template",get:function(){function e(e){return e<10?"0":""}var t=parseInt(this.time/60,10),n=this.time-60*t;return'\n<header>\n  <svg xmlns="http://www.w3.org/2000/svg" class="timer" viewBox="0 0 780 780">\n    <circle\n      cx="390" cy="390" r="370"\n      class="timer-line"\n      style="filter: url(.#blur); transform: rotate(-90deg) scaleY(-1); transform-origin: center"></circle>\n\n    <div class="timer-value" xmlns="http://www.w3.org/1999/xhtml">\n      <span class="timer-value-mins">'.concat(e(t)).concat(t,'</span>\x3c!--\n      --\x3e<span class="timer-value-dots">:</span>\x3c!--\n      --\x3e<span class="timer-value-secs">').concat(e(n)).concat(n,'</span>\n    </div>\n  </svg>\n  <div class="main-mistakes">\n    ').concat(function(e){var t="";if(0<e)for(;e;)t+='<img class="main-mistake" src="img/wrong-answer.png" width="35" height="49">',e--;return t}(this.errors),"\n  </div>\n</header>")}}]),i}(),H=function(){function n(e){var t;return r(this,n),(t=o(this,s(n).call(this))).level=e,t}return e(n,t),a(n,[{key:"bind",value:function(){var t=this,n=u(".genre-answer-send",this.element),i=l(this.element.querySelectorAll('.genre-answer input[type="checkbox"]'));i.forEach(function(e){m("change",function(){i.some(function(e){return e.checked})?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled")},e)}),m("click",function(e){return t.handlerAnswer(e)},n)}},{key:"handlerAnswer",value:function(e){e.preventDefault();var t=l(e.target.form.elements.answer);f("answerGenre",t)}},{key:"template",get:function(){var e=this.level,t=e.title,n=e.questions;return'\n<section class="main main--level main--level-genre">\n  <div class="main-wrap">\n    <h2 class="title">'.concat(t,'</h2>\n    <form class="genre">\n\n      ').concat(n.reduce(function(e,t,n){var i=n++;return e+'\n<div class="genre-answer">\n  <div class="player-wrapper">\n    <div class="player">\n      <audio src="'.concat(t.src,'"></audio>\n      <button class="player-control player-control--play"></button>\n      <div class="player-track">\n        <span class="player-status"></span>\n      </div>\n    </div>\n  </div>\n  <input type="checkbox" name="answer" value="answer-').concat(i,'" id="a-').concat(i,'">\n  <label class="genre-answer-check" for="a-').concat(i,'"></label>\n</div>')},""),'\n\n      <button class="genre-answer-send" type="submit" disabled>Answer</button>\n    </form>\n  </div>\n</section>').trim()}}]),n}(),I=function(){function n(e){var t;return r(this,n),(t=o(this,s(n).call(this))).level=e,t}return e(n,t),a(n,[{key:"bind",value:function(){l(this.element.querySelectorAll(".main-answer-r")).forEach(function(t){m("change",function(){var e=t.form.elements.answer.value;f("answerArtist",e)},t)})}},{key:"template",get:function(){var e=this.level,t=e.title,n=e.questions,i=e.src;return'\n<section class="main main--level main--level-genre">\n  <div class="main-wrap">\n    <h2 class="title main-title">'.concat(t,'</h2>\n    <div class="player-wrapper">\n      <div class="player">\n        <audio src="').concat(i,'" loop autoplay></audio>\n        <button class="player-control player-control--pause"></button>\n        <div class="player-track">\n          <span class="player-status"></span>\n        </div>\n      </div>\n    </div>\n    <form class="main-list">\n\n      ').concat(n.reduce(function(e,t,n){var i=n++;return e+'\n<div class="main-answer-wrapper">\n  <input class="main-answer-r" type="radio" id="answer-'.concat(i,'" name="answer" value="val-').concat(i,'"/>\n  <label class="main-answer" for="answer-').concat(i,'">\n    <img class="main-answer-preview" src="').concat(t.image,'"\n        alt="').concat(t.artist,'" width="134" height="134">\n    ').concat(t.artist,"\n  </label>\n</div>").trim()},""),"\n\n    </form>\n  </div>\n</section>").trim()}}]),n}(),W="player-control",Y="player-control--pause",B="player-control--play",z=function(){function n(e){var t;return r(this,n),(t=o(this,s(n).call(this))).model=e,t}return e(n,t),a(n,[{key:"bind",value:function(){return c(s(n.prototype),"bind",this).call(this)}},{key:"bindAudioHandler",value:function(){var t=this;l(this.level.element.querySelectorAll(".".concat(W))).forEach(function(e){m("click",function(e){return t.audioHandler(e)},e)})}},{key:"updateLevel",value:function(e){this.level=this.view[e](this.model.getCurrentLevel()),this.bindAudioHandler(),h(this.level),this.updateHeader()}},{key:"updateHeader",value:function(){var e=new P(this.model.getMistakes(),this.model.state.time),t=u("section.main > header");null!==t&&t.remove(),u("section.main").prepend(e.element)}},{key:"audioHandler",value:function(e){if(e&&e.target){e.preventDefault();var t=e.target;t.classList.contains(B)?(l(this.level.element.querySelectorAll(".".concat(Y))).forEach(function(e){e.classList.remove(Y),e.classList.add(B),e.previousElementSibling.pause()}),t.classList.remove(B),t.classList.add(Y),t.previousElementSibling.play()):(t.classList.remove(Y),t.classList.add(B),t.previousElementSibling.pause())}}},{key:"template",get:function(){return'<section class="main"></section>'}},{key:"view",get:function(){return{Genre:function(e){return new H(e)},Artist:function(e){return new I(e)}}}}]),n}(),D=function(){function n(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:b;r(this,n),this.model=new M(e),this.view=new z(this.model),m("answerGenre",function(e){return t.answerGenreHandler(e)}),m("answerArtist",function(e){return t.answerArtistHandler(e)})}return a(n,[{key:"init",value:function(e){var t=0<arguments.length&&void 0!==e?e:_;this.model.resetAnswers(t),this.model.update(t),this.model.nextLevel(),this.changeLevel(this.model.getLevelType())}},{key:"setAnswer",value:function(e){var t={isCorrect:e===b[this.model.state.level].answer,timeSpent:20},n=this.model.state.answers;n.push(t);var i=this.model.state.remainingAttempts;t.isCorrect||i--,this.model.update({answers:n,remainingAttempts:i})}},{key:"setGame",value:function(){this.model.isLastLevel()&&this.model.getMistakes()<4?(this.model.win(),F.showResult("WIN")):4<=this.model.getMistakes()?(this.model.failOnMistakes(),F.showResult("TRY")):(this.model.nextLevel(),this.changeLevel(this.model.getLevelType()))}},{key:"changeLevel",value:function(e){this.view.updateLevel(e)}},{key:"tick",value:function(){var e=this;this.model.tick(),this.view.updateHeader(),this.model.state.time<=0?F.showResult("TIME"):this.timer=setTimeout(function(){return e.tick()},1e3)}},{key:"stopTimer",value:function(){clearTimeout(this.timer)}},{key:"answerGenreHandler",value:function(e){var t=e.detail,n="",i=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){n+=s.value.checked?1:0}}catch(e){r=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}this.setAnswer(n),this.setGame()}},{key:"answerArtistHandler",value:function(e){var t=+e.detail.split("-")[1];this.setAnswer(t),this.setGame()}}]),n}(),J=function(){function n(e){var t;return r(this,n),(t=o(this,s(n).call(this))).data=e,t}return e(n,t),a(n,[{key:"bind",value:function(){m("click",function(){return f("replay")},u(".main-replay",this.element))}},{key:"template",get:function(){var e=this.data,t=e.name,n=e.button,i=e.title,r=e.content,a=e.isWin,s=e.score,o=e.errors,c="\nIn&nbsp;3&nbsp;m Ð¸ 25&nbsp;s\n<br>you&nbsp;got ".concat(s," points (8 quick)\n<br>made ").concat(o," errors");return'\n<section class="main main--result">\n  <section class="logo" title="'.concat(t,'"><h1>').concat(t,'</h1></section>\n\n  <h2 class="title">').concat(i,'</h2>\n  <div class="main-stat">\n    ').concat(a?c:r,"\n  </div>\n  ").concat(a?'<span class="main-comparison">'.concat(r,"</span>"):"",'\n  <span role="button" tabindex="0" class="main-replay">').concat(n,"</span>\n</section>").trim()}}]),n}(),K=function(){function t(e){r(this,t),this.view=new J(e)}return a(t,[{key:"init",value:function(){h(this.view)}}]),t}(),U={TRY:O,TIME:S,WIN:j},F=function(){function i(){r(this,i)}return a(i,null,[{key:"init",value:function(e){R.init(),i.game=new D(e),m("start",i.startGame),m("replay",i.startGame)}},{key:"startGame",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:_;i.game.init(n),i.game.tick()}},{key:"showResult",value:function(e){i.game.stopTimer(),new K(U[e]).init()}}]),i}();F.init(b)}();
//# sourceMappingURL=main.js.map
